<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pramin - Envie Vídeo</title>
</head>
<body>
<h1>Pramin - Envie seu vídeo</h1>
<input type="file" id="videoInput" accept="video/*">
<button id="uploadBtn">Gerar Link</button>
<p id="status"></p>
<p id="link"></p>

<script>
const uploadBtn = document.getElementById('uploadBtn');
const fileInput = document.getElementById('videoInput');
const status = document.getElementById('status');
const linkOutput = document.getElementById('link');

// Coloque seu token do Dropbox aqui
const DROPBOX_TOKEN = "sl.u.AGQ30crFk2iPvvABSNT-JGbSvRRqroo_tqMsJN6mpwZtWVYHhY0vcjIdoqwpDK4XoK6hnBBI73NilSdettWwQFOrvFldW61MkW73LMMCSQjzf9LVYALNK3_h0JuAgYO5gaWfcVQ3vtJ2Nf8SHUcVy_XRg4huOja1HFoFrkc1K8YvXvy893Vmczyw5VeiMY_SRLeGoF7bpqOMmg6kvTGfF5q0_LB4yWtgtiV6zT0rLUKIlCKcCWuYk-NidY60LzToKdsHsWlVEMAq3hlEtfSNDmAtV6aiwXD6_JvQCVIgntXz-98WfGstVzct9W8pgXJjAesH9uX7g8PoIfegdfRM8He6Wo0ML393aQFlNf6gGTqopnmc4OGdA9lxtVO2UdPyreuubk0kffUrp-ZLyV3Eg4hr-th9zf0l0_v2vvHNKsLeFYlv9p3kEYSJcPuPxmP9cPBh335jpBoy58y-hQsVO8wKLPz8KBmlQT4m3ZbH165a0fbHUfJkEvl7g-74kqT01VKU9Y14UZsbjwQCe1m1YNGcZyi_PgrD-IGZEmZxDopo25RT56dowVCVXPIhtHNhxG_aK7tUrbRJ5vu-Abz9YmiwQAsZF2Qx8p0zyylbu3op6EUDAn_aQXC4BT_vhu6zROvDPIkZFWb9MsKCQAlJa2ydBCb5uCeU9jKJQF2kM3p2lwiuijDV-dzM4HCKsg2-zmcTkYWPZyVkEGaY_1uKO33vt8SupXVpee3xkkFJ8neupjoBaXVAeNURqlHpu7RDEVc54VenNqCwIaqJFvo7FsFn0E5UK8OeA_evtY0rP-Z9nfIVBubAO8xuG0UODAg_sFVdbGXV6XyMMrLB-gmp2ZuyQ_GDMv2y-wQFmavTdtOAkYGEaMPQz9NQIJzg9KX4uOLUONsSzqPeYH6nUNbvFatU9_3r5FBLnpAbrKk-Q0H5asQE7101hus4PVfp40vCwEnQBAY8ixJ_L7lw4eZ2HX9VCvRlN7HKU6Yb3IoF_E66zuQyL2KTi-7SBd2HPz_Gxu_3PhzoCMKsnLAePa9BVZxWPu1U0hkp7efQrnhZkJZN0YaD2vqyNUk7ZMwky6HrWiXuaB1xgNkdTWum9X5ZRNVQTKtTj9Y6sWv6yjEckvaasZYWr-nKKJsXfeXlzsuLBLHuuCBLbPFvMAS-fSe0PvRGrxczoNRLbNCt4_5nV6VRWYQnXUm3nIviq20FwajTgwX74sOCbM5w3SdqEfzlf7DpUBehyqkbRn8QqsJX4DOrRxOGL6VrtB1iix1pbQN5tmM";

uploadBtn.addEventListener('click', async () => {
  if(fileInput.files.length === 0){
    alert("Escolha um vídeo primeiro!");
    return;
  }

  const file = fileInput.files[0];
  const reader = new FileReader();
  status.textContent = "Upload em andamento...";

  reader.onload = async function(e){
    const base64 = e.target.result.split(',')[1];

    try {
      const response = await fetch('https://content.dropboxapi.com/2/files/upload', {
        method: 'POST',
        headers: {
          "Authorization": "Bearer " + DROPBOX_TOKEN,
          "Dropbox-API-Arg": JSON.stringify({
            path: "/" + file.name,
            mode: "add",
            autorename: true,
            mute: false
          }),
          "Content-Type": "application/octet-stream"
        },
        body: Uint8Array.from(atob(base64), c => c.charCodeAt(0))
      });

      if(response.ok){
        // Gerar link compartilhável
        const linkRes = await fetch('https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings', {
          method: 'POST',
          headers: {
            "Authorization": "Bearer " + DROPBOX_TOKEN,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({path: "/" + file.name})
        });

        const linkData = await linkRes.json();
        status.textContent = "Upload concluído!";
        linkOutput.innerHTML = `<a href="${linkData.url.replace("?dl=0","?dl=1")}" target="_blank">${linkData.url.replace("?dl=0","?dl=1")}</a>`;
      } else {
        status.textContent = "Erro no upload";
      }
    } catch(err){
      status.textContent = "Erro: " + err.message;
    }
  };

  reader.readAsDataURL(file);
});
</script>
</body>
</html>